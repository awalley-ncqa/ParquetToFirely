{
  "description": "Encounter diagnosis use flat vw",
  "resource": "Encounter",
  "resourceType": "ViewDefinition",
  "name": "encounter_diagnosis_use_vw",
  "title": "encounter_diagnosis_use_vw",
  "status": "draft",
  "select": [
    {
      "column": [
        {
          "name": "encounter_id",
          "path": "getResourceKey()",
          "type": "string"
        }
      ],
      "select": [
        {
          "forEach": "diagnosis",
          "column": [
            {
              "name": "diagnosis_index",
              "path": "$index",
              "type": "integer"
            },
            {
              "name": "text",
              "path": "use.text",
              "type": "string"
            }
          ],
          "select": [
            {
              "forEach": "use.coding",
              "column": [
                {
                  "name": "index",
                  "path": "$index",
                  "type": "integer"
                },
                {
                  "name": "system",
                  "path": "system",
                  "type": "uri"
                },
                {
                  "name": "version",
                  "path": "version",
                  "type": "string"
                },
                {
                  "name": "code",
                  "path": "code",
                  "type": "code"
                },
                {
                  "name": "display",
                  "path": "display",
                  "type": "string"
                },
                {
                  "name": "userselected",
                  "path": "userSelected",
                  "type": "boolean"
                }
              ]
            }
          ]
        }
      ]
    }
  ]
}
